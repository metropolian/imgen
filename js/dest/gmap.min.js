function create_maker(e,t,o,r){var n=t.color,a=new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|"+n,new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34)),i=new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_shadow",new google.maps.Size(40,37),new google.maps.Point(0,0),new google.maps.Point(12,35));return marker=new google.maps.Marker({map:map,draggable:t.draggable,animation:google.maps.Animation.DROP,position:e,label:{color:"white",text:"x"},icon:a,shadow:i}),o&&marker.addListener("click",o),r&&marker.addListener("dragend",r),marker}function update_current_location(e){current_marker||(current_marker=create_maker(e,{text:"S",color:"f00",draggable:!0},null,null),current_marker.addListener("drag",update_current_location)),current_marker.setPosition(e),current_marker&&current_dest_marker&&update_direction(current_marker.getPosition(),current_dest_marker.getPosition())}function update_destination(e){null==current_dest_marker&&(current_dest_marker=create_maker(e,{text:"D",color:"00f",draggable:!0},null,update_destination)),current_dest_marker.setPosition(e),current_marker&&current_dest_marker&&update_direction(current_marker.getPosition(),current_dest_marker.getPosition())}function update_direction(e,t){directions_service.route({origin:e,destination:t,travelMode:google.maps.TravelMode.DRIVING},function(e,t){t==google.maps.DirectionsStatus.OK?(console.log(e),directions_display.setDirections(e)):window.alert("Directions request failed due to "+t)})}function initial(){var e={lat:13.896627,lng:100.6087728};geocoder=new google.maps.Geocoder,map=new google.maps.Map(document.getElementById("map"),{center:e,zoom:16});var t=document.getElementById("from"),o=new google.maps.places.SearchBox(t);t.addEventListener("click",function(e){this.select()}),o.addListener("places_changed",function(){var e=o.getPlaces();e.length>0&&(console.log(e),update_current_location(e[0].geometry.location))}),map.addListener("bounds_changed",function(){o.setBounds(map.getBounds())}),directions_display=new google.maps.DirectionsRenderer({markerOptions:{visible:!1},polylineOptions:{strokeColor:"#88f",strokeOpacity:1,strokeWeight:10}}),directions_service=new google.maps.DirectionsService,directions_display.setMap(map),map.addListener("click",function(e){update_current_location(e.latLng),geocoder.geocode({location:e.latLng},function(e,o){o===google.maps.GeocoderStatus.OK&&(t.value=e[0].formatted_address,console.log(e))})}),setup_current_location(),update_destination(e)}function setup_current_location(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){null==current_pos&&(current_pos={lat:e.coords.latitude,lng:e.coords.longitude},map.panTo(current_pos),map.setZoom(16),update_current_location(current_pos))},function(){},{enableHighAccuracy:!0,maximumAge:0})}var map,geocoder,current_pos,current_marker,current_dest_marker,directions_display,directions_service;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdtYXAuanMiXSwibmFtZXMiOlsiY3JlYXRlX21ha2VyIiwicG9zIiwib3B0aW9ucyIsIm9uX2NsaWNrIiwib25fY2hhbmdlZCIsInBpbkNvbG9yIiwiY29sb3IiLCJwaW5JbWFnZSIsImdvb2dsZSIsIm1hcHMiLCJNYXJrZXJJbWFnZSIsIlNpemUiLCJQb2ludCIsInBpblNoYWRvdyIsIm1hcmtlciIsIk1hcmtlciIsIm1hcCIsImRyYWdnYWJsZSIsImFuaW1hdGlvbiIsIkFuaW1hdGlvbiIsIkRST1AiLCJwb3NpdGlvbiIsImxhYmVsIiwidGV4dCIsImljb24iLCJzaGFkb3ciLCJhZGRMaXN0ZW5lciIsInVwZGF0ZV9jdXJyZW50X2xvY2F0aW9uIiwic3JjIiwiY3VycmVudF9tYXJrZXIiLCJzZXRQb3NpdGlvbiIsImN1cnJlbnRfZGVzdF9tYXJrZXIiLCJ1cGRhdGVfZGlyZWN0aW9uIiwiZ2V0UG9zaXRpb24iLCJ1cGRhdGVfZGVzdGluYXRpb24iLCJkZXN0IiwiZGlyZWN0aW9uc19zZXJ2aWNlIiwicm91dGUiLCJvcmlnaW4iLCJkZXN0aW5hdGlvbiIsInRyYXZlbE1vZGUiLCJUcmF2ZWxNb2RlIiwiRFJJVklORyIsInJlc3BvbnNlIiwic3RhdHVzIiwiRGlyZWN0aW9uc1N0YXR1cyIsIk9LIiwiY29uc29sZSIsImxvZyIsImRpcmVjdGlvbnNfZGlzcGxheSIsInNldERpcmVjdGlvbnMiLCJ3aW5kb3ciLCJhbGVydCIsImluaXRpYWwiLCJsYXQiLCJsbmciLCJnZW9jb2RlciIsIkdlb2NvZGVyIiwiTWFwIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImNlbnRlciIsInpvb20iLCJpbnB1dCIsInNlYXJjaEJveCIsInBsYWNlcyIsIlNlYXJjaEJveCIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwidGhpcyIsInNlbGVjdCIsImdldFBsYWNlcyIsImxlbmd0aCIsImdlb21ldHJ5IiwibG9jYXRpb24iLCJzZXRCb3VuZHMiLCJnZXRCb3VuZHMiLCJEaXJlY3Rpb25zUmVuZGVyZXIiLCJtYXJrZXJPcHRpb25zIiwidmlzaWJsZSIsInBvbHlsaW5lT3B0aW9ucyIsInN0cm9rZUNvbG9yIiwic3Ryb2tlT3BhY2l0eSIsInN0cm9rZVdlaWdodCIsIkRpcmVjdGlvbnNTZXJ2aWNlIiwic2V0TWFwIiwibGF0TG5nIiwiZ2VvY29kZSIsInJlc3VsdHMiLCJHZW9jb2RlclN0YXR1cyIsInZhbHVlIiwiZm9ybWF0dGVkX2FkZHJlc3MiLCJzZXR1cF9jdXJyZW50X2xvY2F0aW9uIiwibmF2aWdhdG9yIiwiZ2VvbG9jYXRpb24iLCJnZXRDdXJyZW50UG9zaXRpb24iLCJjdXJyZW50X3BvcyIsImNvb3JkcyIsImxhdGl0dWRlIiwibG9uZ2l0dWRlIiwicGFuVG8iLCJzZXRab29tIiwiZW5hYmxlSGlnaEFjY3VyYWN5IiwibWF4aW11bUFnZSJdLCJtYXBwaW5ncyI6IkFBTUksUUFBU0EsY0FBYUMsRUFBS0MsRUFBU0MsRUFBVUMsR0FDMUMsR0FBSUMsR0FBV0gsRUFBUUksTUFDbkJDLEVBQVcsR0FBSUMsUUFBT0MsS0FBS0MsWUFBWSwyRUFBNkVMLEVBQ3BILEdBQUlHLFFBQU9DLEtBQUtFLEtBQUssR0FBSSxJQUN6QixHQUFJSCxRQUFPQyxLQUFLRyxNQUFNLEVBQUUsR0FDeEIsR0FBSUosUUFBT0MsS0FBS0csTUFBTSxHQUFJLEtBRTFCQyxFQUFZLEdBQUlMLFFBQU9DLEtBQUtDLFlBQVksMkRBQ3hDLEdBQUlGLFFBQU9DLEtBQUtFLEtBQUssR0FBSSxJQUN6QixHQUFJSCxRQUFPQyxLQUFLRyxNQUFNLEVBQUcsR0FDekIsR0FBSUosUUFBT0MsS0FBS0csTUFBTSxHQUFJLElBa0I5QixPQWhCQUUsUUFBUyxHQUFJTixRQUFPQyxLQUFLTSxRQUNUQyxJQUFLQSxJQUNMQyxVQUFXZixFQUFRZSxVQUNuQkMsVUFBV1YsT0FBT0MsS0FBS1UsVUFBVUMsS0FDakNDLFNBQVVwQixFQUNWcUIsT0FDSWhCLE1BQU8sUUFDUGlCLEtBQU0sS0FFVkMsS0FBTWpCLEVBQ05rQixP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clxuICAgIHZhciBnZW9jb2RlcjtcclxuICAgIHZhciBjdXJyZW50X3BvcztcclxuICAgIHZhciBjdXJyZW50X21hcmtlcjtcclxuICAgICAgXHJcbiAgICBcclxuICAgIGZ1bmN0aW9uIGNyZWF0ZV9tYWtlcihwb3MsIG9wdGlvbnMsIG9uX2NsaWNrLCBvbl9jaGFuZ2VkKSB7XHJcbiAgICAgICAgdmFyIHBpbkNvbG9yID0gb3B0aW9ucy5jb2xvcjtcclxuICAgICAgICB2YXIgcGluSW1hZ2UgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VySW1hZ2UoXCJodHRwOi8vY2hhcnQuYXBpcy5nb29nbGUuY29tL2NoYXJ0P2Noc3Q9ZF9tYXBfcGluX2xldHRlciZjaGxkPSVFMiU4MCVBMnxcIiArIHBpbkNvbG9yLFxyXG4gICAgICAgICAgICBuZXcgZ29vZ2xlLm1hcHMuU2l6ZSgyMSwgMzQpLFxyXG4gICAgICAgICAgICBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoMCwwKSxcclxuICAgICAgICAgICAgbmV3IGdvb2dsZS5tYXBzLlBvaW50KDEwLCAzNCkpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICB2YXIgcGluU2hhZG93ID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlckltYWdlKFwiaHR0cDovL2NoYXJ0LmFwaXMuZ29vZ2xlLmNvbS9jaGFydD9jaHN0PWRfbWFwX3Bpbl9zaGFkb3dcIixcclxuICAgICAgICAgICAgbmV3IGdvb2dsZS5tYXBzLlNpemUoNDAsIDM3KSxcclxuICAgICAgICAgICAgbmV3IGdvb2dsZS5tYXBzLlBvaW50KDAsIDApLFxyXG4gICAgICAgICAgICBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoMTIsIDM1KSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXA6IG1hcCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZHJhZ2dhYmxlOiBvcHRpb25zLmRyYWdnYWJsZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHBvcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiAnd2hpdGUnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogJ3gnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGljb246IHBpbkltYWdlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzaGFkb3c6IHBpblNoYWRvd1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIGlmIChvbl9jbGljaylcclxuICAgICAgICAgICAgbWFya2VyLmFkZExpc3RlbmVyKCdjbGljaycsIG9uX2NsaWNrKTtcclxuICAgICAgICBpZiAob25fY2hhbmdlZClcclxuICAgICAgICAgICAgbWFya2VyLmFkZExpc3RlbmVyKCdkcmFnZW5kJywgb25fY2hhbmdlZCk7XHJcbiAgICAgICAgcmV0dXJuIG1hcmtlcjsgICAgICAgICAgICBcclxuICAgIH1cclxuICAgIFxyXG4gICAgZnVuY3Rpb24gdXBkYXRlX2N1cnJlbnRfbG9jYXRpb24oc3JjKSB7IFxyXG4gICAgICAgIGlmICghY3VycmVudF9tYXJrZXIpIHtcclxuICAgICAgICAgICAgY3VycmVudF9tYXJrZXIgPSBjcmVhdGVfbWFrZXIoc3JjLCBcclxuICAgICAgICAgICAgICAgIHt0ZXh0OiAnUycsIGNvbG9yOiAnZjAwJywgZHJhZ2dhYmxlOiB0cnVlfSwgXHJcbiAgICAgICAgICAgICAgICBudWxsLCBcclxuICAgICAgICAgICAgICAgIG51bGwpO1xyXG4gICAgICAgICAgICBjdXJyZW50X21hcmtlci5hZGRMaXN0ZW5lcignZHJhZycsIHVwZGF0ZV9jdXJyZW50X2xvY2F0aW9uKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY3VycmVudF9tYXJrZXIuc2V0UG9zaXRpb24oc3JjKTtcclxuICAgICAgICBcclxuICAgICAgICBpZiAoY3VycmVudF9tYXJrZXIgJiYgY3VycmVudF9kZXN0X21hcmtlcilcclxuICAgICAgICAgICAgdXBkYXRlX2RpcmVjdGlvbihjdXJyZW50X21hcmtlci5nZXRQb3NpdGlvbigpLCBjdXJyZW50X2Rlc3RfbWFya2VyLmdldFBvc2l0aW9uKCkpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICB2YXIgY3VycmVudF9kZXN0X21hcmtlcjtcclxuICAgIFxyXG4gICAgZnVuY3Rpb24gdXBkYXRlX2Rlc3RpbmF0aW9uKGRlc3QpIHtcclxuICAgICAgICBpZiAoY3VycmVudF9kZXN0X21hcmtlciA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGN1cnJlbnRfZGVzdF9tYXJrZXIgPSBjcmVhdGVfbWFrZXIoZGVzdCwgXHJcbiAgICAgICAgICAgICAgICB7dGV4dDogJ0QnLCBjb2xvcjogJzAwZicsIGRyYWdnYWJsZTogdHJ1ZX0sIG51bGwsIHVwZGF0ZV9kZXN0aW5hdGlvbik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGN1cnJlbnRfZGVzdF9tYXJrZXIuc2V0UG9zaXRpb24oZGVzdCk7XHJcbiAgICAgICAgaWYgKGN1cnJlbnRfbWFya2VyICYmIGN1cnJlbnRfZGVzdF9tYXJrZXIpXHJcbiAgICAgICAgICAgIHVwZGF0ZV9kaXJlY3Rpb24oY3VycmVudF9tYXJrZXIuZ2V0UG9zaXRpb24oKSwgY3VycmVudF9kZXN0X21hcmtlci5nZXRQb3NpdGlvbigpKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgXHJcbiAgICB2YXIgZGlyZWN0aW9uc19kaXNwbGF5O1xyXG4gICAgdmFyIGRpcmVjdGlvbnNfc2VydmljZTsgXHJcbiAgICBcclxuICAgIGZ1bmN0aW9uIHVwZGF0ZV9kaXJlY3Rpb24oc3JjLCBkZXN0KSB7XHJcbiAgICAgICAgZGlyZWN0aW9uc19zZXJ2aWNlLnJvdXRlKHtcclxuICAgICAgICAgICAgICAgIG9yaWdpbjogc3JjLCAgXHJcbiAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbjogZGVzdCwgXHJcbiAgICAgICAgICAgICAgICAvLyBOb3RlIHRoYXQgSmF2YXNjcmlwdCBhbGxvd3MgdXMgdG8gYWNjZXNzIHRoZSBjb25zdGFudFxyXG4gICAgICAgICAgICAgICAgLy8gdXNpbmcgc3F1YXJlIGJyYWNrZXRzIGFuZCBhIHN0cmluZyB2YWx1ZSBhcyBpdHNcclxuICAgICAgICAgICAgICAgIC8vIFwicHJvcGVydHkuXCJcclxuICAgICAgICAgICAgICAgIHRyYXZlbE1vZGU6IGdvb2dsZS5tYXBzLlRyYXZlbE1vZGUuRFJJVklOR1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbihyZXNwb25zZSwgc3RhdHVzKSB7XHJcbiAgICAgICAgICAgIGlmIChzdGF0dXMgPT0gZ29vZ2xlLm1hcHMuRGlyZWN0aW9uc1N0YXR1cy5PSykge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coKHJlc3BvbnNlKSk7XHJcbiAgICAgICAgICAgICAgZGlyZWN0aW9uc19kaXNwbGF5LnNldERpcmVjdGlvbnMocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIHdpbmRvdy5hbGVydCgnRGlyZWN0aW9ucyByZXF1ZXN0IGZhaWxlZCBkdWUgdG8gJyArIHN0YXR1cyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9XHJcbiAgICBcclxuICAgIGZ1bmN0aW9uIGluaXRpYWwoKSB7XHJcbiAgICAgICAgdmFyIGRlc3QgPSB7IGxhdDogMTMuODk2NjI3LCBsbmc6IDEwMC42MDg3NzI4IH07XHJcbiAgICAgICAgZ2VvY29kZXIgPSBuZXcgZ29vZ2xlLm1hcHMuR2VvY29kZXI7XHJcbiAgICAgICAgbWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcclxuICAgICAgICAgICAgY2VudGVyOiBkZXN0LFxyXG4gICAgICAgICAgICB6b29tOiAxNlxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8vIENyZWF0ZSB0aGUgc2VhcmNoIGJveCBhbmQgbGluayBpdCB0byB0aGUgVUkgZWxlbWVudC5cclxuICAgICAgICB2YXIgaW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZnJvbScpOyAgICAgICAgXHJcbiAgICAgICAgdmFyIHNlYXJjaEJveCA9IG5ldyBnb29nbGUubWFwcy5wbGFjZXMuU2VhcmNoQm94KGlucHV0KTtcclxuICAgICAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7IHRoaXMuc2VsZWN0KCk7IH0pO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHNlYXJjaEJveC5hZGRMaXN0ZW5lcigncGxhY2VzX2NoYW5nZWQnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIHBsYWNlcyA9IHNlYXJjaEJveC5nZXRQbGFjZXMoKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChwbGFjZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocGxhY2VzKTtcclxuICAgICAgICAgICAgICAgIHVwZGF0ZV9jdXJyZW50X2xvY2F0aW9uKCBwbGFjZXNbMF0uZ2VvbWV0cnkubG9jYXRpb24gKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8vbWFwLmNvbnRyb2xzW2dvb2dsZS5tYXBzLkNvbnRyb2xQb3NpdGlvbi5UT1BfTEVGVF0ucHVzaChpbnB1dCk7XHJcblxyXG4gICAgICAgIC8vIEJpYXMgdGhlIFNlYXJjaEJveCByZXN1bHRzIHRvd2FyZHMgY3VycmVudCBtYXAncyB2aWV3cG9ydC5cclxuICAgICAgICBtYXAuYWRkTGlzdGVuZXIoJ2JvdW5kc19jaGFuZ2VkJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHNlYXJjaEJveC5zZXRCb3VuZHMobWFwLmdldEJvdW5kcygpKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBcclxuICAgICAgICBkaXJlY3Rpb25zX2Rpc3BsYXkgPSBuZXcgZ29vZ2xlLm1hcHMuRGlyZWN0aW9uc1JlbmRlcmVyKHtcclxuICAgICAgICAgICAgbWFya2VyT3B0aW9uczp7dmlzaWJsZTpmYWxzZX0sXHJcbiAgICAgICAgICAgIHBvbHlsaW5lT3B0aW9uczp7c3Ryb2tlQ29sb3I6JyM4OGYnLHN0cm9rZU9wYWNpdHk6IDEsc3Ryb2tlV2VpZ2h0OiAxMH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBkaXJlY3Rpb25zX3NlcnZpY2UgPSBuZXcgZ29vZ2xlLm1hcHMuRGlyZWN0aW9uc1NlcnZpY2U7XHJcbiAgICAgICAgZGlyZWN0aW9uc19kaXNwbGF5LnNldE1hcChtYXApO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vdmFyIHRyYWZmaWNMYXllciA9IG5ldyBnb29nbGUubWFwcy5UcmFmZmljTGF5ZXIoKTtcclxuICAgICAgICAvL3RyYWZmaWNMYXllci5zZXRNYXAobWFwKTsgICAgICAgIFxyXG4gICAgICAgIFxyXG4gICAgICAgIG1hcC5hZGRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7IFxyXG4gICAgICAgICAgICB1cGRhdGVfY3VycmVudF9sb2NhdGlvbihlLmxhdExuZyk7IFxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZ2VvY29kZXIuZ2VvY29kZSh7J2xvY2F0aW9uJzogZS5sYXRMbmd9LCBmdW5jdGlvbihyZXN1bHRzLCBzdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT09IGdvb2dsZS5tYXBzLkdlb2NvZGVyU3RhdHVzLk9LKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWUgPSByZXN1bHRzWzBdLmZvcm1hdHRlZF9hZGRyZXNzO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdHMpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vaW5mb3dpbmRvdy5zZXRDb250ZW50KHJlc3VsdHNbMV0uZm9ybWF0dGVkX2FkZHJlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vaW5mb3dpbmRvdy5vcGVuKG1hcCwgbWFya2VyKTtcclxuICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIFxyXG4gICAgICAgIFxyXG5cclxuXHJcbiAgICAgICAgc2V0dXBfY3VycmVudF9sb2NhdGlvbigpO1xyXG4gICAgICAgIC8vdXBkYXRlX2N1cnJlbnRfbG9jYXRpb24oKTtcclxuICAgICAgICB1cGRhdGVfZGVzdGluYXRpb24oZGVzdCk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGZ1bmN0aW9uIHNldHVwX2N1cnJlbnRfbG9jYXRpb24oKSB7XHJcbiAgICAgICAgaWYgKG5hdmlnYXRvci5nZW9sb2NhdGlvbikge1xyXG4gICAgICAgICAgICBuYXZpZ2F0b3IuZ2VvbG9jYXRpb24uZ2V0Q3VycmVudFBvc2l0aW9uKCBmdW5jdGlvbiAocG9zKSB7XHJcbiAgICAgICAgICAgICAgICAvL2FsZXJ0KFwiTGF0aXR1ZGU6IFwiICsgcG9zLmNvb3Jkcy5sYXRpdHVkZSArIFwiXFxyXFxuTG9uZ2l0dWRlOiBcIiArIHBvcy5jb29yZHMubG9uZ2l0dWRlKTtcclxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50X3BvcyA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudF9wb3MgPSB7IGxhdDogcG9zLmNvb3Jkcy5sYXRpdHVkZSwgbG5nOiBwb3MuY29vcmRzLmxvbmdpdHVkZSB9O1xyXG4gICAgICAgICAgICAgICAgICAgIG1hcC5wYW5UbyhjdXJyZW50X3Bvcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgbWFwLnNldFpvb20oMTYpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB1cGRhdGVfY3VycmVudF9sb2NhdGlvbihjdXJyZW50X3Bvcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgLy8gZmFpbGVkIC4uLiBkbyBub3RoaW5nXHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfSwge1xyXG4gICAgICAgICAgICAgICAgZW5hYmxlSGlnaEFjY3VyYWN5OiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgbWF4aW11bUFnZTogMCAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfSApOyBcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICB9XHJcbiAgICBcclxuIl19
